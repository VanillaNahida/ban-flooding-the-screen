# 刷屏禁言插件

AstrBot 刷屏禁言插件，检测到刷屏时自动禁言，屡犯者将被踢出群。支持超长文本识别并禁言

## 功能特性

- 自动检测群聊中的刷屏行为
- 检测到刷屏后自动禁言用户
- **支持超长文本识别禁言**：单条消息超过设定字数时自动禁言
- 支持累计触发次数统计
- 屡犯者自动踢出群
- 可自定义各项参数
- 支持群级别独立配置
- 管理员命令控制

## 管理员命令

以下命令仅限群主和管理员使用，如果机器人没有管理员权限，会返回"bot权限不足，需要管理员权限"：

| 命令 | 说明 | 参数/示例 |
|------|------|-----------|
| `/开启刷屏禁言` | 在当前群开启刷屏检测功能 | - |
| `/关闭刷屏禁言` | 在当前群关闭刷屏检测功能 | - |
| `/设置刷屏禁言时间 <时间>` | 设置禁言时长 | 支持格式：<br>- `1分`、`1分钟`、`1m` - 1分钟<br>- `1小时`、`1h` - 60分钟<br>- `1天`、`1d` - 1440分钟<br>- 纯数字（如 `10`）- 视为分钟<br><br>示例：<br>- `/设置刷屏禁言时间 10分钟`<br>- `/设置刷屏禁言时间 1小时`<br>- `/设置刷屏禁言时间 2d` |
| `/开启刷屏踢人` | 在当前群开启屡犯踢人功能 | - |
| `/关闭刷屏踢人` | 在当前群关闭屡犯踢人功能 | - |
| `/设置刷屏踢人次数 <次数>` | 设置累计多少次后踢出 | 示例：`/设置刷屏踢人次数 5` - 累计触发5次后踢出 |
| `/重置刷屏次数 @用户` | 重置指定用户的刷屏累计次数 | 示例：`/重置刷屏次数 @用户名` - 清除该用户的累计触发次数 |

## 配置说明

### 启用群列表 (`enabled_groups`)
- 类型：列表
- 默认值：`[]`
- 说明：填入需要开启刷屏检测的群号（纯数字）。如果留空，则对机器人所在的所有群生效。
- 注意：此配置已弃用，请使用命令 `/开启刷屏禁言` 在群内开启功能

### 检测周期 (`detection_period`)
- 类型：整数
- 默认值：`4`
- 说明：在此时间内发送的消息数量达到阈值即触发禁言。单位：秒。

### 消息条数 (`message_threshold`)
- 类型：整数
- 默认值：`4`
- 说明：在检测周期内发送的消息数量达到此数值即触发禁言。

### 禁言提示语 (`mute_message`)
- 类型：字符串
- 默认值：`"检测到刷屏，已自动禁言，如有异议请联系管理员"`
- 说明：触发刷屏禁言后发送的消息。留空则不发送消息。
- 可用变量：`{at_user}`（@用户）、`{nickname}`（用户昵称）、`{mute_time}`（禁言时长）

### 踢群提示语 (`kick_message`)
- 类型：字符串
- 默认值：`"{at_user} 你已累计触发刷屏禁言 {count} 次，已被请出本群。"`
- 说明：用户被踢出群时发送的消息。
- 可用变量：`{at_user}`（@用户）、`{count}`（累计次数）

### 是否开启超长消息禁言 (`enable_long_message_ban`)
- 类型：布尔值
- 默认值：`false`
- 说明：是否启用超长消息检测功能。启用后，当单条消息字数超过阈值时会触发禁言。

### 超长消息判断阈值 (`long_message_threshold`)
- 类型：整数
- 默认值：`500`
- 说明：单条消息字数超过此数值即触发禁言。

### 超长消息禁言提示语 (`long_message_mute_message`)
- 类型：字符串
- 默认值：`"{at_user} 你的消息字数超过{threshold}字，构成刷屏，已自动禁言，发送长文本建议合并转发形式发送，如有异议或者误判请联系管理员。"`
- 说明：触发超长消息禁言后发送的消息。
- 可用变量：`{at_user}`（@用户）、`{threshold}`（字数阈值）、`{mute_time}`（禁言时长）

### 群级别配置 (`group_configs`)
- 类型：模板列表 (template_list)
- 说明：为不同的群配置不同的刷屏检测参数。可以在 WebUI 上快速添加和编辑群配置。
- 提供三种预设模板：
  - **默认配置**：适用于大多数群的标准配置
    - 禁言时长：10分钟
    - 启用屡犯踢群：是
    - 踢群阈值：5次
    - 踢群延迟：3秒
    - 开启超长消息禁言：否
    - 超长消息阈值：500字
  - **严格配置**：适用于管理严格的群
    - 禁言时长：30分钟
    - 启用屡犯踢群：是
    - 踢群阈值：3次
    - 踢群延迟：5秒
    - 开启超长消息禁言：是
    - 超长消息阈值：300字
  - **宽松配置**：适用于管理宽松的群
    - 禁言时长：5分钟
    - 启用屡犯踢群：否
    - 踢群阈值：10次
    - 踢群延迟：3秒
    - 开启超长消息禁言：否
    - 超长消息阈值：800字

- 配置项说明：
  - `group_id`：群号（字符串）
  - `mute_time`：禁言时长（分钟）
  - `enable_kick`：是否启用屡犯踢群（布尔值）
  - `kick_threshold`：踢群阈值（整数）
  - `kick_delay`：踢群延迟时间（秒）
  - `enable_long_message_ban`：是否开启超长消息禁言（布尔值）
  - `long_message_threshold`：超长消息判断阈值（整数）

- 使用方式：
  - 在 WebUI 的插件配置页面，点击"群级别配置"的添加按钮
  - 选择预设模板或手动配置
  - 填入群号和各项参数
  - 保存配置即可生效

- 注意：
  - 群级别配置会覆盖全局默认值
  - 如果某个群没有配置，将使用全局默认值
  - 也可以通过命令 `/设置刷屏禁言时间`、`/开启刷屏踢人`、`/设置刷屏踢人次数` 在群内单独设置，这些设置会自动保存到群级别配置中

## 权限要求

机器人需要在群中拥有管理员或群主权限才能执行禁言和踢人操作。
管理员命令仅限群主和管理员使用。

## 注意事项
- 累计触发次数使用持久化存储，重启后仍然保留
- 每个群可以独立配置是否启用刷屏检测、禁言时间和踢人次数
- 使用命令配置的设置会保存到配置文件中，重载插件生效
- 触发刷屏禁言时会@刷屏用户，并提示累计次数（如果启用了踢人功能）
- **超长消息检测**：单条消息字数超过设定阈值时触发禁言，与刷屏检测相互独立
- **超长消息提示**：建议用户使用合并转发形式发送长文本内容
